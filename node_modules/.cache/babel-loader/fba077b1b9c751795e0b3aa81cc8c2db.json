{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Loader = EnyoLoader;\nexports[\"default\"] = void 0;\n\nvar _util = require(\"@enact/core/util\");\n\nvar _Loader = _interopRequireDefault(require(\"ilib/lib/Loader\"));\n\nvar _LocaleInfo = _interopRequireDefault(require(\"ilib/lib/LocaleInfo\"));\n\nvar _xhr = _interopRequireDefault(require(\"xhr\"));\n\nvar _zoneinfo = _interopRequireDefault(require(\"./zoneinfo\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n/* global XMLHttpRequest, ILIB_BASE_PATH, ILIB_RESOURCES_PATH, ILIB_CACHE_ID */\n\n\nvar getImpl = function getImpl(url, callback, sync) {\n  if (typeof XMLHttpRequest !== 'undefined') {\n    _xhr[\"default\"].XMLHttpRequest = XMLHttpRequest || _xhr[\"default\"].XMLHttpRequest;\n    var req;\n    (0, _xhr[\"default\"])({\n      url: url,\n      sync: sync,\n      beforeSend: function beforeSend(r) {\n        return req = r;\n      }\n    }, function (err, resp, body) {\n      var error = err || resp.statusCode !== 200 && resp.statusCode; // false failure from chrome and file:// urls\n\n      if (error && req.status === 0 && req.response.length > 0) {\n        body = req.response;\n        error = false;\n      }\n\n      var json = null;\n\n      try {\n        json = error ? null : JSON.parse(body);\n      } catch (e) {\n        error = 'Failed to parse ILIB JSON data';\n      }\n\n      callback(json, error);\n    });\n  } else {\n    callback(null, new Error('Not a web browser environment'));\n  }\n};\n\nvar getSync = function getSync(url, callback) {\n  return getImpl(url, callback, true);\n};\n\nvar get = (0, _util.memoize)(function (url) {\n  return new Promise(function (resolve, reject) {\n    getImpl(url, function (json, error) {\n      if (error) {\n        reject(error);\n      } else {\n        resolve(json);\n      }\n    }, false);\n  });\n});\nvar iLibBase = typeof ILIB_BASE_PATH === 'undefined' ? '/ilib' : ILIB_BASE_PATH;\nvar iLibResources = typeof ILIB_RESOURCES_PATH === 'undefined' ? '/locale' : ILIB_RESOURCES_PATH;\nvar cachePrefix = 'ENACT-ILIB-';\nvar cacheKey = cachePrefix + 'CACHE-ID';\nvar cacheID = typeof ILIB_CACHE_ID === 'undefined' ? '$ILIB' : ILIB_CACHE_ID;\n\nfunction EnyoLoader() {\n  this.base = iLibBase; // TODO: full enyo.platform implementation for improved accuracy\n\n  if (typeof window === 'object' && typeof window.PalmSystem === 'object') {\n    this.webos = true;\n  }\n}\n\nEnyoLoader.prototype = new _Loader[\"default\"]();\nEnyoLoader.prototype.constructor = EnyoLoader;\n\nEnyoLoader.prototype._createZoneFile = function (path) {\n  var zone = path.substring(path.indexOf('zoneinfo')); // remove the .json suffix to get the name of the zone\n\n  zone = zone.substring(0, zone.length - 5);\n\n  try {\n    var zif = new _zoneinfo[\"default\"]('/usr/share/' + zone); // only get the info for this year. Later we can get the info\n    // for any historical or future year too\n\n    return zif.getIlibZoneInfo(new Date());\n  } catch (e) {// no file, so just return nothing\n  }\n};\n\nEnyoLoader.prototype._pathjoin = function (_root, subpath) {\n  if (!_root || !_root.length) {\n    return subpath;\n  }\n\n  if (!subpath || !subpath.length) {\n    return _root;\n  }\n\n  return _root + (_root.charAt(_root.length - 1) !== '/' ? '/' : '') + subpath;\n};\n/**\n * Load the list of files asynchronously. This uses recursion in\n * order to create a queue of files that will be loaded serially.\n * Each layer, starting at the bottom, loads a file and then loads\n * the layer on top of it. The very top file on the stack will have\n * zero files to load, so instead it will be the one to call the\n * callback to notify the caller that all the content is loaded.\n *\n * @param {Array.<string>} paths array of strings containing relative paths for required locale data\n *\tfiles\n * @param {Array} results empty array in which to place the resulting json when it is loaded from a\n *\tfile\n * @param {Object} params An object full of parameters that the caller is passing to this function\n *\tto help load the files\n * @param {function(Array.<Object>)} callback callback to call when this function is finished\n *\tattempting to load all the files that exist and can be loaded\n *\n * @returns {Promise}\n */\n\n\nEnyoLoader.prototype._loadFilesAsync = function (path, params, cache, rootPath) {\n  var _this = this;\n\n  var _root = iLibResources;\n\n  if (typeof rootPath !== 'undefined') {\n    _root = rootPath;\n  } else if (params && typeof params.root !== 'undefined') {\n    _root = params.root; // Deprecated; to be removed in future\n  }\n\n  var cacheItem = cache.data.shift(),\n      url;\n\n  if (this.webos && path.indexOf('zoneinfo') !== -1) {\n    // TODO: Sort out async zone file loading\n    return this._createZoneFile(path);\n  } else if (cacheItem) {\n    return Promise.resolve(cacheItem);\n  }\n\n  return this.loadManifests(_root).then(function () {\n    var isRootAvailable = _this.isAvailable(_root, path);\n\n    if (isRootAvailable) {\n      url = _this._pathjoin(_root, path);\n    } else {\n      var localeBase = _this._pathjoin(_this.base, 'locale');\n\n      var isBaseAvailable = _this.isAvailable(localeBase, path);\n\n      if (isBaseAvailable) {\n        url = _this._pathjoin(localeBase, path);\n      }\n    }\n\n    if (url) {\n      return get(url).then(function (json) {\n        if (typeof json === 'object') {\n          cache.update = true;\n          return json;\n        } else if (path === 'localeinfo.json') {\n          return _LocaleInfo[\"default\"].defaultInfo;\n        }\n      });\n    }\n\n    return null;\n  });\n};\n\nEnyoLoader.prototype._loadFilesCache = function (_root, paths) {\n  this._validateCache();\n\n  if (typeof window !== 'undefined' && window.localStorage && paths.length > 0) {\n    var stored = window.localStorage.getItem(cachePrefix + _root + '/' + paths[0]);\n\n    if (stored) {\n      var target = JSON.stringify(paths);\n      var data = JSON.parse(stored);\n\n      if (data.target === target) {\n        return data.value;\n      } else {\n        window.localStorage.removeItem(cachePrefix + _root + '/' + paths[0]);\n      }\n    }\n  }\n\n  return new Array(paths.length);\n};\n\nEnyoLoader.prototype._storeFilesCache = function (_root, paths, data) {\n  if (typeof window !== 'undefined' && window.localStorage && paths.length > 0) {\n    var target = JSON.stringify(paths);\n    window.localStorage.setItem(cachePrefix + _root + '/' + paths[0], JSON.stringify({\n      target: target,\n      value: data\n    }));\n  }\n};\n\nEnyoLoader.prototype._validateCache = function () {\n  if (!this._cacheValidated && typeof window !== 'undefined' && window.localStorage) {\n    var activeID = window.localStorage.getItem(cacheKey);\n\n    if (activeID !== cacheID) {\n      for (var i = 0; i < window.localStorage.length; i++) {\n        var key = window.localStorage.key(i);\n\n        if (key.indexOf(cachePrefix) === 0) {\n          window.localStorage.removeItem(key);\n          i--;\n        }\n      }\n\n      window.localStorage.setItem(cacheKey, cacheID);\n    }\n  }\n\n  this._cacheValidated = true;\n};\n\nEnyoLoader.prototype.loadFiles = function (paths, sync, params, callback, rootPath) {\n  var _this2 = this;\n\n  var _root = iLibResources;\n\n  if (typeof rootPath !== 'undefined') {\n    _root = rootPath;\n  } else if (params && typeof params.root !== 'undefined') {\n    _root = params.root; // Deprecated; to be removed in future\n  }\n\n  var cache = {\n    data: this._loadFilesCache(_root, paths)\n  };\n\n  if (sync) {\n    var ret = [];\n\n    var locdata = this._pathjoin(this.base, 'locale'); // synchronous\n\n\n    paths.forEach(function (path, index) {\n      if (this.webos && path.indexOf('zoneinfo') !== -1) {\n        ret.push(this._createZoneFile(path));\n      } else if (cache.data[index]) {\n        ret.push(cache.data[index]);\n      } else {\n        var found = false;\n\n        var handler = function handler(json, err) {\n          if (!err && typeof json === 'object') {\n            cache.update = true;\n            ret.push(json);\n            found = true;\n          }\n        };\n\n        this.loadManifestsSync(_root);\n\n        if (this.isAvailable(_root, path)) {\n          getSync(this._pathjoin(_root, path), handler);\n        }\n\n        if (!found && this.isAvailable(locdata, path)) {\n          getSync(this._pathjoin(locdata, path), handler);\n        }\n\n        if (!found) {\n          if (path === 'localeinfo.json') {\n            // Use default locale info when xhr on root localeinfo.json fails/skips\n            ret.push(_LocaleInfo[\"default\"].defaultInfo);\n          } else {\n            // not there, so fill in a blank entry in the array\n            // eslint-disable-next-line no-undefined\n            ret.push(undefined);\n          }\n        }\n      }\n    }.bind(this));\n\n    if (cache.update) {\n      this._storeFilesCache(_root, paths, ret);\n    }\n\n    if (typeof callback === 'function') {\n      callback.call(this, ret);\n    }\n\n    return ret;\n  } // asynchronous\n\n\n  Promise.all(paths.map(function (path) {\n    return _this2._loadFilesAsync(path, params, cache);\n  })).then(function (results) {\n    if (cache.update) {\n      _this2._storeFilesCache(_root, paths, results);\n    }\n\n    if (typeof callback === 'function') {\n      callback.call(_this2, results);\n    }\n  });\n};\n\nEnyoLoader.prototype._handleManifest = function (dirpath, filepath, json) {\n  // star indicates there was no ilibmanifest.json, so always try to load files from\n  // that dir\n  if (json != null) {\n    if (typeof window !== 'undefined' && window.localStorage) {\n      window.localStorage.setItem(cachePrefix + filepath, JSON.stringify(json));\n    }\n\n    this.manifest[dirpath] = json.files;\n  } else {\n    this.manifest[dirpath] = '*';\n  }\n\n  return this.manifest[dirpath];\n};\n\nEnyoLoader.prototype._loadManifest = function (_root, subpath, sync) {\n  var _this3 = this;\n\n  if (!this.manifest) {\n    this.manifest = {};\n  }\n\n  var dirpath = this._pathjoin(_root, subpath);\n\n  var filepath = this._pathjoin(dirpath, 'ilibmanifest.json');\n\n  if (this.manifest[dirpath]) {\n    return;\n  }\n\n  var cachedManifest;\n\n  if (typeof window !== 'undefined' && window.localStorage) {\n    cachedManifest = window.localStorage.getItem(cachePrefix + filepath);\n  }\n\n  if (cachedManifest) {\n    this.manifest[dirpath] = JSON.parse(cachedManifest).files;\n    return sync ? this.manifest[dirpath] : Promise.resolve(this.manifest[dirpath]);\n  }\n\n  if (sync) {\n    getSync(filepath, function (json) {\n      _this3._handleManifest(dirpath, filepath, json);\n    });\n    return;\n  }\n\n  return get(filepath).then(function (json) {\n    return _this3._handleManifest(dirpath, filepath, json);\n  });\n};\n\nEnyoLoader.prototype.loadManifests = function (_root) {\n  this._validateCache();\n\n  return Promise.all([// standard ilib locale data\n  this._loadManifest(this.base, 'locale'), // the app's resources dir\n  this._loadManifest('', iLibResources), // maybe it's a custom root? If so, try to load\n  // the manifest file first in case it is there\n  this._loadManifest(_root, '')]);\n};\n\nEnyoLoader.prototype.loadManifestsSync = function (_root) {\n  // load standard manifests\n  if (!this.manifest) {\n    this._validateCache();\n\n    this._loadManifest(this.base, 'locale', true); // standard ilib locale data\n\n\n    this._loadManifest('', iLibResources, true); // the app's resources dir\n\n  }\n\n  if (!this.manifest[_root]) {\n    // maybe it's a custom root? If so, try to load\n    // the manifest file first in case it is there\n    this._loadManifest(_root, '', true);\n  }\n};\n\nEnyoLoader.prototype.isAvailable = function (_root, path) {\n  // util.print('enyo loader: isAvailable ' + path + '? ');\n  // star means attempt to load everything because there was no manifest in that dir\n  if (this.manifest[_root] === '*' || this.manifest[_root].indexOf(path) !== -1) {\n    // util.print('true\\n');\n    return true;\n  } // util.print('false\\n');\n\n\n  return false;\n};\n\nvar _default = EnyoLoader;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/sonjaeseong/workspace/webOS/CARROT/webOS_GUI/node_modules/@enact/i18n/src/Loader.js"],"names":["Object","defineProperty","exports","value","Loader","EnyoLoader","_util","require","_Loader","_interopRequireDefault","_LocaleInfo","_xhr","_zoneinfo","obj","__esModule","getImpl","url","callback","sync","XMLHttpRequest","req","beforeSend","r","err","resp","body","error","statusCode","status","response","length","json","JSON","parse","e","Error","getSync","get","memoize","Promise","resolve","reject","iLibBase","ILIB_BASE_PATH","iLibResources","ILIB_RESOURCES_PATH","cachePrefix","cacheKey","cacheID","ILIB_CACHE_ID","base","window","PalmSystem","webos","prototype","constructor","_createZoneFile","path","zone","substring","indexOf","zif","getIlibZoneInfo","Date","_pathjoin","_root","subpath","charAt","_loadFilesAsync","params","cache","rootPath","_this","root","cacheItem","data","shift","loadManifests","then","isRootAvailable","isAvailable","localeBase","isBaseAvailable","update","defaultInfo","_loadFilesCache","paths","_validateCache","localStorage","stored","getItem","target","stringify","removeItem","Array","_storeFilesCache","setItem","_cacheValidated","activeID","i","key","loadFiles","_this2","ret","locdata","forEach","index","push","found","handler","loadManifestsSync","undefined","bind","call","all","map","results","_handleManifest","dirpath","filepath","manifest","files","_loadManifest","_this3","cachedManifest","_default"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Loader = EnyoLoader;\nexports[\"default\"] = void 0;\n\nvar _util = require(\"@enact/core/util\");\n\nvar _Loader = _interopRequireDefault(require(\"ilib/lib/Loader\"));\n\nvar _LocaleInfo = _interopRequireDefault(require(\"ilib/lib/LocaleInfo\"));\n\nvar _xhr = _interopRequireDefault(require(\"xhr\"));\n\nvar _zoneinfo = _interopRequireDefault(require(\"./zoneinfo\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\n/* global XMLHttpRequest, ILIB_BASE_PATH, ILIB_RESOURCES_PATH, ILIB_CACHE_ID */\nvar getImpl = function getImpl(url, callback, sync) {\n  if (typeof XMLHttpRequest !== 'undefined') {\n    _xhr[\"default\"].XMLHttpRequest = XMLHttpRequest || _xhr[\"default\"].XMLHttpRequest;\n    var req;\n    (0, _xhr[\"default\"])({\n      url: url,\n      sync: sync,\n      beforeSend: function beforeSend(r) {\n        return req = r;\n      }\n    }, function (err, resp, body) {\n      var error = err || resp.statusCode !== 200 && resp.statusCode; // false failure from chrome and file:// urls\n\n      if (error && req.status === 0 && req.response.length > 0) {\n        body = req.response;\n        error = false;\n      }\n\n      var json = null;\n\n      try {\n        json = error ? null : JSON.parse(body);\n      } catch (e) {\n        error = 'Failed to parse ILIB JSON data';\n      }\n\n      callback(json, error);\n    });\n  } else {\n    callback(null, new Error('Not a web browser environment'));\n  }\n};\n\nvar getSync = function getSync(url, callback) {\n  return getImpl(url, callback, true);\n};\n\nvar get = (0, _util.memoize)(function (url) {\n  return new Promise(function (resolve, reject) {\n    getImpl(url, function (json, error) {\n      if (error) {\n        reject(error);\n      } else {\n        resolve(json);\n      }\n    }, false);\n  });\n});\nvar iLibBase = typeof ILIB_BASE_PATH === 'undefined' ? '/ilib' : ILIB_BASE_PATH;\nvar iLibResources = typeof ILIB_RESOURCES_PATH === 'undefined' ? '/locale' : ILIB_RESOURCES_PATH;\nvar cachePrefix = 'ENACT-ILIB-';\nvar cacheKey = cachePrefix + 'CACHE-ID';\nvar cacheID = typeof ILIB_CACHE_ID === 'undefined' ? '$ILIB' : ILIB_CACHE_ID;\n\nfunction EnyoLoader() {\n  this.base = iLibBase; // TODO: full enyo.platform implementation for improved accuracy\n\n  if (typeof window === 'object' && typeof window.PalmSystem === 'object') {\n    this.webos = true;\n  }\n}\n\nEnyoLoader.prototype = new _Loader[\"default\"]();\nEnyoLoader.prototype.constructor = EnyoLoader;\n\nEnyoLoader.prototype._createZoneFile = function (path) {\n  var zone = path.substring(path.indexOf('zoneinfo')); // remove the .json suffix to get the name of the zone\n\n  zone = zone.substring(0, zone.length - 5);\n\n  try {\n    var zif = new _zoneinfo[\"default\"]('/usr/share/' + zone); // only get the info for this year. Later we can get the info\n    // for any historical or future year too\n\n    return zif.getIlibZoneInfo(new Date());\n  } catch (e) {// no file, so just return nothing\n  }\n};\n\nEnyoLoader.prototype._pathjoin = function (_root, subpath) {\n  if (!_root || !_root.length) {\n    return subpath;\n  }\n\n  if (!subpath || !subpath.length) {\n    return _root;\n  }\n\n  return _root + (_root.charAt(_root.length - 1) !== '/' ? '/' : '') + subpath;\n};\n/**\n * Load the list of files asynchronously. This uses recursion in\n * order to create a queue of files that will be loaded serially.\n * Each layer, starting at the bottom, loads a file and then loads\n * the layer on top of it. The very top file on the stack will have\n * zero files to load, so instead it will be the one to call the\n * callback to notify the caller that all the content is loaded.\n *\n * @param {Array.<string>} paths array of strings containing relative paths for required locale data\n *\tfiles\n * @param {Array} results empty array in which to place the resulting json when it is loaded from a\n *\tfile\n * @param {Object} params An object full of parameters that the caller is passing to this function\n *\tto help load the files\n * @param {function(Array.<Object>)} callback callback to call when this function is finished\n *\tattempting to load all the files that exist and can be loaded\n *\n * @returns {Promise}\n */\n\n\nEnyoLoader.prototype._loadFilesAsync = function (path, params, cache, rootPath) {\n  var _this = this;\n\n  var _root = iLibResources;\n\n  if (typeof rootPath !== 'undefined') {\n    _root = rootPath;\n  } else if (params && typeof params.root !== 'undefined') {\n    _root = params.root; // Deprecated; to be removed in future\n  }\n\n  var cacheItem = cache.data.shift(),\n      url;\n\n  if (this.webos && path.indexOf('zoneinfo') !== -1) {\n    // TODO: Sort out async zone file loading\n    return this._createZoneFile(path);\n  } else if (cacheItem) {\n    return Promise.resolve(cacheItem);\n  }\n\n  return this.loadManifests(_root).then(function () {\n    var isRootAvailable = _this.isAvailable(_root, path);\n\n    if (isRootAvailable) {\n      url = _this._pathjoin(_root, path);\n    } else {\n      var localeBase = _this._pathjoin(_this.base, 'locale');\n\n      var isBaseAvailable = _this.isAvailable(localeBase, path);\n\n      if (isBaseAvailable) {\n        url = _this._pathjoin(localeBase, path);\n      }\n    }\n\n    if (url) {\n      return get(url).then(function (json) {\n        if (typeof json === 'object') {\n          cache.update = true;\n          return json;\n        } else if (path === 'localeinfo.json') {\n          return _LocaleInfo[\"default\"].defaultInfo;\n        }\n      });\n    }\n\n    return null;\n  });\n};\n\nEnyoLoader.prototype._loadFilesCache = function (_root, paths) {\n  this._validateCache();\n\n  if (typeof window !== 'undefined' && window.localStorage && paths.length > 0) {\n    var stored = window.localStorage.getItem(cachePrefix + _root + '/' + paths[0]);\n\n    if (stored) {\n      var target = JSON.stringify(paths);\n      var data = JSON.parse(stored);\n\n      if (data.target === target) {\n        return data.value;\n      } else {\n        window.localStorage.removeItem(cachePrefix + _root + '/' + paths[0]);\n      }\n    }\n  }\n\n  return new Array(paths.length);\n};\n\nEnyoLoader.prototype._storeFilesCache = function (_root, paths, data) {\n  if (typeof window !== 'undefined' && window.localStorage && paths.length > 0) {\n    var target = JSON.stringify(paths);\n    window.localStorage.setItem(cachePrefix + _root + '/' + paths[0], JSON.stringify({\n      target: target,\n      value: data\n    }));\n  }\n};\n\nEnyoLoader.prototype._validateCache = function () {\n  if (!this._cacheValidated && typeof window !== 'undefined' && window.localStorage) {\n    var activeID = window.localStorage.getItem(cacheKey);\n\n    if (activeID !== cacheID) {\n      for (var i = 0; i < window.localStorage.length; i++) {\n        var key = window.localStorage.key(i);\n\n        if (key.indexOf(cachePrefix) === 0) {\n          window.localStorage.removeItem(key);\n          i--;\n        }\n      }\n\n      window.localStorage.setItem(cacheKey, cacheID);\n    }\n  }\n\n  this._cacheValidated = true;\n};\n\nEnyoLoader.prototype.loadFiles = function (paths, sync, params, callback, rootPath) {\n  var _this2 = this;\n\n  var _root = iLibResources;\n\n  if (typeof rootPath !== 'undefined') {\n    _root = rootPath;\n  } else if (params && typeof params.root !== 'undefined') {\n    _root = params.root; // Deprecated; to be removed in future\n  }\n\n  var cache = {\n    data: this._loadFilesCache(_root, paths)\n  };\n\n  if (sync) {\n    var ret = [];\n\n    var locdata = this._pathjoin(this.base, 'locale'); // synchronous\n\n\n    paths.forEach(function (path, index) {\n      if (this.webos && path.indexOf('zoneinfo') !== -1) {\n        ret.push(this._createZoneFile(path));\n      } else if (cache.data[index]) {\n        ret.push(cache.data[index]);\n      } else {\n        var found = false;\n\n        var handler = function handler(json, err) {\n          if (!err && typeof json === 'object') {\n            cache.update = true;\n            ret.push(json);\n            found = true;\n          }\n        };\n\n        this.loadManifestsSync(_root);\n\n        if (this.isAvailable(_root, path)) {\n          getSync(this._pathjoin(_root, path), handler);\n        }\n\n        if (!found && this.isAvailable(locdata, path)) {\n          getSync(this._pathjoin(locdata, path), handler);\n        }\n\n        if (!found) {\n          if (path === 'localeinfo.json') {\n            // Use default locale info when xhr on root localeinfo.json fails/skips\n            ret.push(_LocaleInfo[\"default\"].defaultInfo);\n          } else {\n            // not there, so fill in a blank entry in the array\n            // eslint-disable-next-line no-undefined\n            ret.push(undefined);\n          }\n        }\n      }\n    }.bind(this));\n\n    if (cache.update) {\n      this._storeFilesCache(_root, paths, ret);\n    }\n\n    if (typeof callback === 'function') {\n      callback.call(this, ret);\n    }\n\n    return ret;\n  } // asynchronous\n\n\n  Promise.all(paths.map(function (path) {\n    return _this2._loadFilesAsync(path, params, cache);\n  })).then(function (results) {\n    if (cache.update) {\n      _this2._storeFilesCache(_root, paths, results);\n    }\n\n    if (typeof callback === 'function') {\n      callback.call(_this2, results);\n    }\n  });\n};\n\nEnyoLoader.prototype._handleManifest = function (dirpath, filepath, json) {\n  // star indicates there was no ilibmanifest.json, so always try to load files from\n  // that dir\n  if (json != null) {\n    if (typeof window !== 'undefined' && window.localStorage) {\n      window.localStorage.setItem(cachePrefix + filepath, JSON.stringify(json));\n    }\n\n    this.manifest[dirpath] = json.files;\n  } else {\n    this.manifest[dirpath] = '*';\n  }\n\n  return this.manifest[dirpath];\n};\n\nEnyoLoader.prototype._loadManifest = function (_root, subpath, sync) {\n  var _this3 = this;\n\n  if (!this.manifest) {\n    this.manifest = {};\n  }\n\n  var dirpath = this._pathjoin(_root, subpath);\n\n  var filepath = this._pathjoin(dirpath, 'ilibmanifest.json');\n\n  if (this.manifest[dirpath]) {\n    return;\n  }\n\n  var cachedManifest;\n\n  if (typeof window !== 'undefined' && window.localStorage) {\n    cachedManifest = window.localStorage.getItem(cachePrefix + filepath);\n  }\n\n  if (cachedManifest) {\n    this.manifest[dirpath] = JSON.parse(cachedManifest).files;\n    return sync ? this.manifest[dirpath] : Promise.resolve(this.manifest[dirpath]);\n  }\n\n  if (sync) {\n    getSync(filepath, function (json) {\n      _this3._handleManifest(dirpath, filepath, json);\n    });\n    return;\n  }\n\n  return get(filepath).then(function (json) {\n    return _this3._handleManifest(dirpath, filepath, json);\n  });\n};\n\nEnyoLoader.prototype.loadManifests = function (_root) {\n  this._validateCache();\n\n  return Promise.all([// standard ilib locale data\n  this._loadManifest(this.base, 'locale'), // the app's resources dir\n  this._loadManifest('', iLibResources), // maybe it's a custom root? If so, try to load\n  // the manifest file first in case it is there\n  this._loadManifest(_root, '')]);\n};\n\nEnyoLoader.prototype.loadManifestsSync = function (_root) {\n  // load standard manifests\n  if (!this.manifest) {\n    this._validateCache();\n\n    this._loadManifest(this.base, 'locale', true); // standard ilib locale data\n\n\n    this._loadManifest('', iLibResources, true); // the app's resources dir\n\n  }\n\n  if (!this.manifest[_root]) {\n    // maybe it's a custom root? If so, try to load\n    // the manifest file first in case it is there\n    this._loadManifest(_root, '', true);\n  }\n};\n\nEnyoLoader.prototype.isAvailable = function (_root, path) {\n  // util.print('enyo loader: isAvailable ' + path + '? ');\n  // star means attempt to load everything because there was no manifest in that dir\n  if (this.manifest[_root] === '*' || this.manifest[_root].indexOf(path) !== -1) {\n    // util.print('true\\n');\n    return true;\n  } // util.print('false\\n');\n\n\n  return false;\n};\n\nvar _default = EnyoLoader;\nexports[\"default\"] = _default;"]},"metadata":{},"sourceType":"module"}