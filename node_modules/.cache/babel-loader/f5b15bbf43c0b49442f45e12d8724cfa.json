{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Spotlight = exports.getDirection = exports[\"default\"] = void 0;\n\nvar _keymap = require(\"@enact/core/keymap\");\n\nvar _snapshot = require(\"@enact/core/snapshot\");\n\nvar _platform = _interopRequireDefault(require(\"@enact/core/platform\"));\n\nvar _last = _interopRequireDefault(require(\"ramda/src/last\"));\n\nvar _Accelerator = _interopRequireDefault(require(\"../Accelerator\"));\n\nvar _Spottable = require(\"../Spottable\");\n\nvar _Pause = require(\"../Pause\");\n\nvar _utils = require(\"./utils\");\n\nvar _container = require(\"./container\");\n\nvar _pointer = require(\"./pointer\");\n\nvar _target = require(\"./target\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n/*\n * A javascript-based implementation of Spatial Navigation.\n *\n * Copyright (c) 2016 Luke Chang.\n * https://github.com/luke-chang/js-spatial-navigation\n *\n * Licensed under the MPL license.\n */\n\n/**\n * Exports the {@link spotlight.Spotlight} object used for controlling spotlight behavior and the\n * {@link spotlight.Spotlight.getDirection} function for mapping a keycode to a spotlight direction.\n *\n * The default export is {@link spotlight.Spotlight}.\n *\n * @module spotlight\n * @exports default Spotlight\n * @exports getDirection\n */\n\n\nvar isDown = (0, _keymap.is)('down');\nvar isEnter = (0, _keymap.is)('enter');\nvar isLeft = (0, _keymap.is)('left');\nvar isRight = (0, _keymap.is)('right');\nvar isUp = (0, _keymap.is)('up');\n/**\n * Translates keyCodes into 5-way direction descriptions (e.g. `'down'`)\n *\n * @function\n * @memberof spotlight\n * @param {Number} keyCode - Key code to analyze\n * @returns {String|false} - One of `'up'`, `'down'`, `'left'`, `'right'` or `false` if not a direction key\n * @public\n */\n\nvar getDirection = function getDirection(keyCode) {\n  return isDown(keyCode) && 'down' || isLeft(keyCode) && 'left' || isRight(keyCode) && 'right' || isUp(keyCode) && 'up';\n};\n\nexports.getDirection = getDirection;\nvar SpotlightAccelerator = new _Accelerator[\"default\"]();\n/**\n * Provides 5-way navigation and focus support\n *\n * ```\n * import Spotlight from '@enact/Spotlight';\n *\n * // get the currently focused component\n * const current = Spotlight.getCurrent();\n *\n * // focus an element by CSS selector\n * Spotlight.focus('.my-custom-class');\n *\n * // is `current` focusable?\n * const isFocused = Spotlight.isSpottable(current);\n * ```\n *\n * @type {Object}\n * @memberof spotlight\n * @public\n */\n\nvar Spotlight = function () {\n  'use strict';\n  /*\n  /* private vars\n  */\n\n  var _initialized = false;\n  var _duringFocusChange = false;\n  /*\n   * Whether a 5-way directional key is being held.\n   *\n   * @type {Boolean}\n   * @default false\n   */\n\n  var _5WayKeyHold = false;\n  /*\n   * Whether to set focus during the next window focus event\n   *\n   * @type {Boolean}\n   * @default false\n   */\n\n  var _spotOnWindowFocus = false;\n  /*\n   * `true` when a pointer move event occurs during a keypress. Used to short circuit key down\n   * handling until the next keyup occurs.\n   *\n   * @type {Boolean}\n   * @default false\n   */\n\n  var _pointerMoveDuringKeyPress = false;\n  /*\n  * protected methods\n  */\n\n  function preventDefault(evt) {\n    evt.preventDefault();\n    evt.stopPropagation();\n    return false;\n  }\n\n  function shouldPreventNavigation() {\n    return (0, _Pause.isPaused)() || (0, _container.getAllContainerIds)().length === 0;\n  }\n\n  function _getCurrent() {\n    if (!(0, _snapshot.isWindowReady)()) return;\n    var activeElement = document.activeElement;\n\n    if (activeElement && activeElement !== document.body) {\n      return activeElement;\n    }\n  } // An extension point for updating pointer mode based on the current platform.\n  // Currently only webOS\n\n\n  function setPlatformPointerMode() {\n    var palmSystem = window.PalmSystem;\n\n    if (palmSystem && palmSystem.cursor) {\n      (0, _pointer.setPointerMode)(palmSystem.cursor.visibility);\n    }\n  }\n\n  function focusElement(elem, containerIds, fromPointer) {\n    if (!elem) {\n      return false;\n    }\n\n    if ((0, _pointer.getPointerMode)() && !fromPointer) {\n      (0, _container.setContainerLastFocusedElement)(elem, containerIds);\n      return false;\n    }\n\n    var currentFocusedElement = _getCurrent();\n\n    if (elem === currentFocusedElement) {\n      return true;\n    }\n\n    var focusOptions = (0, _container.isWithinOverflowContainer)(elem, containerIds) ? {\n      preventScroll: true\n    } : null;\n\n    var silentFocus = function silentFocus() {\n      elem.focus(focusOptions);\n      focusChanged(elem, containerIds);\n    };\n\n    if (_duringFocusChange) {\n      silentFocus();\n      return true;\n    }\n\n    _duringFocusChange = true;\n\n    if ((0, _Pause.isPaused)()) {\n      silentFocus();\n      _duringFocusChange = false;\n      return true;\n    }\n\n    elem.focus(focusOptions);\n    _duringFocusChange = false;\n    focusChanged(elem, containerIds);\n    return true;\n  }\n\n  function focusChanged(elem, containerIds) {\n    if (!containerIds || !containerIds.length) {\n      containerIds = (0, _container.getContainersForNode)(elem);\n    }\n\n    var containerId = (0, _last[\"default\"])(containerIds);\n\n    if (containerId) {\n      (0, _container.setContainerLastFocusedElement)(elem, containerIds);\n      (0, _container.setLastContainer)(containerId);\n    }\n\n    if (process.env.NODE_ENV !== \"production\") {\n      assignFocusPreview(elem);\n    }\n  }\n\n  function restoreFocus() {\n    var lastContainerId = (0, _container.getLastContainer)();\n    var next;\n\n    if (lastContainerId) {\n      var position = (0, _pointer.getLastPointerPosition)(); // walk up the chain of containers from the last to attempt to find a target\n\n      next = (0, _container.getContainersForNode)((0, _container.getContainerNode)(lastContainerId)).reverse(); // only prepend last focused if it exists so that Spotlight.focus() doesn't receive\n      // a falsy target\n\n      var lastFocusedElement = (0, _container.getContainerLastFocusedElement)(lastContainerId);\n\n      while ((0, _container.isContainer)(lastFocusedElement)) {\n        var _getContainerConfig = (0, _container.getContainerConfig)(lastFocusedElement);\n\n        lastFocusedElement = _getContainerConfig.lastFocusedElement;\n      }\n\n      var lastContainerNode = (0, _container.getContainerNode)(lastContainerId);\n\n      if (!lastFocusedElement || lastContainerNode.getBoundingClientRect && lastFocusedElement.getBoundingClientRect && !(0, _utils.contains)(lastContainerNode.getBoundingClientRect(), lastFocusedElement.getBoundingClientRect())) {\n        lastFocusedElement = (0, _container.getContainerConfig)(lastContainerId).overflow && (0, _target.getNearestTargetFromPosition)(position, lastContainerId);\n      }\n\n      if (lastFocusedElement) {\n        next.unshift(lastFocusedElement);\n      }\n    } else {\n      next = [_container.rootContainerId];\n    } // attempt to find a target starting with the last focused element in the last\n    // container, followed by the last container, and finally the root container\n\n\n    return next.reduce(function (focused, target) {\n      return focused || Spotlight.focus(target);\n    }, false);\n  } // The below should be gated on non-production environment only.\n\n\n  function assignFocusPreview(elem) {\n    var directions = ['up', 'right', 'down', 'left'],\n        nextClassBase = _Spottable.spottableClass + '-next-'; // Remove all previous targets\n\n    directions.forEach(function (dir) {\n      var nextClass = nextClassBase + dir,\n          prevElems = (0, _utils.parseSelector)('.' + nextClass);\n\n      if (prevElems && prevElems.length !== 0) {\n        prevElems.forEach(function (prevElem) {\n          return prevElem.classList.remove(nextClass);\n        });\n      }\n    }); // Find all next targets and identify them\n\n    directions.forEach(function (dir) {\n      var nextElem = (0, _target.getTargetByDirectionFromElement)(dir, elem);\n\n      if (nextElem) {\n        nextElem.classList.add(nextClassBase + dir);\n      }\n    });\n  }\n\n  function spotNextFromPoint(direction, position) {\n    var containerId = Spotlight.getActiveContainer();\n    var next = (0, _target.getTargetByDirectionFromPosition)(direction, position, containerId);\n\n    if (next) {\n      (0, _container.setContainerPreviousTarget)(containerId, direction, next, (0, _container.getContainerLastFocusedElement)(containerId));\n      return focusElement(next, (0, _container.getContainersForNode)(next));\n    }\n\n    return false;\n  }\n\n  function spotNext(direction, currentFocusedElement, currentContainerIds) {\n    var next = (0, _target.getTargetByDirectionFromElement)(direction, currentFocusedElement);\n\n    if (next) {\n      var currentContainerId = (0, _last[\"default\"])(currentContainerIds);\n      var nextContainerIds = (0, _container.getContainersForNode)(next); // prevent focus if 5-way is being held and the next element isn't wrapped by\n      // the current element's immediate container\n\n      if (_5WayKeyHold && nextContainerIds.indexOf(currentContainerId) < 0 && !(0, _container.isContainer5WayHoldable)(currentContainerId)) {\n        return false;\n      }\n\n      (0, _container.notifyLeaveContainer)(direction, currentFocusedElement, currentContainerIds, next, nextContainerIds);\n      (0, _container.setContainerPreviousTarget)(currentContainerId, direction, next, currentFocusedElement);\n      var focused = focusElement(next, nextContainerIds);\n      (0, _container.notifyEnterContainer)(direction, currentFocusedElement, currentContainerIds, next, nextContainerIds);\n      return focused;\n    }\n\n    (0, _container.notifyLeaveContainerFail)(direction, currentFocusedElement, currentContainerIds);\n    return false;\n  }\n\n  function onAcceleratedKeyDown(evt) {\n    var direction = getDirection(evt.keyCode);\n    if (!direction) return;\n\n    var currentFocusedElement = _getCurrent();\n\n    var currentContainerIds = (0, _container.getContainersForNode)(currentFocusedElement);\n    spotNext(direction, currentFocusedElement, currentContainerIds);\n  }\n\n  function onBlur() {\n    var current = _getCurrent();\n\n    if (current) {\n      current.blur();\n    }\n\n    Spotlight.setPointerMode(false);\n    _spotOnWindowFocus = true;\n    _pointerMoveDuringKeyPress = false;\n  }\n\n  function handleWebOSMouseEvent(ev) {\n    if (!(0, _Pause.isPaused)() && ev && ev.detail && ev.detail.type === 'Leave') {\n      onBlur();\n    }\n  }\n\n  function handleKeyboardStateChangeEvent(_ref) {\n    var visibility = _ref.visibility;\n\n    if (!visibility) {\n      setPlatformPointerMode();\n    }\n  }\n\n  function onFocus() {\n    // Normally, there isn't focus here unless the window has been blurred above. On webOS, the\n    // platform may focus the window after the app has already focused a component so we prevent\n    // trying to focus something else (potentially) unless the window was previously blurred\n    if (_spotOnWindowFocus) {\n      setPlatformPointerMode(); // If the window was previously blurred while in pointer mode, the last active containerId may\n      // not have yet set focus to its spottable elements. For this reason we can't rely on setting focus\n      // to the last focused element of the last active containerId, so we use rootContainerId instead\n\n      var lastFocusedElement = (0, _container.getContainerLastFocusedElement)(_container.rootContainerId);\n\n      while ((0, _container.isContainer)(lastFocusedElement)) {\n        var _getContainerConfig2 = (0, _container.getContainerConfig)(lastFocusedElement);\n\n        lastFocusedElement = _getContainerConfig2.lastFocusedElement;\n      }\n\n      if (!Spotlight.focus(lastFocusedElement)) {\n        // If the last focused element was previously also disabled (or no longer exists), we\n        // need to set focus somewhere\n        Spotlight.focus();\n      }\n\n      _spotOnWindowFocus = false;\n    }\n  }\n\n  function onKeyUp(evt) {\n    _pointerMoveDuringKeyPress = false;\n    var keyCode = evt.keyCode;\n\n    if (getDirection(keyCode) || isEnter(keyCode)) {\n      SpotlightAccelerator.reset();\n      _5WayKeyHold = false;\n    }\n  }\n\n  function handlePointerHide() {\n    if (!_getCurrent()) {\n      restoreFocus();\n    }\n  }\n\n  function onKeyDown(evt) {\n    if (shouldPreventNavigation()) {\n      (0, _pointer.notifyKeyDown)(evt.keyCode);\n      return;\n    }\n\n    var keyCode = evt.keyCode;\n    var direction = getDirection(keyCode);\n    var pointerHandled = (0, _pointer.notifyKeyDown)(keyCode, handlePointerHide);\n\n    if (pointerHandled || !(direction || isEnter(keyCode))) {\n      return;\n    }\n\n    if (!(0, _Pause.isPaused)() && !_pointerMoveDuringKeyPress) {\n      if (_getCurrent()) {\n        SpotlightAccelerator.processKey(evt, onAcceleratedKeyDown);\n      } else if (!spotNextFromPoint(direction, (0, _pointer.getLastPointerPosition)())) {\n        restoreFocus();\n      }\n\n      _5WayKeyHold = true;\n    }\n\n    if (direction) {\n      preventDefault(evt);\n    }\n  }\n\n  function onMouseMove(_ref2) {\n    var target = _ref2.target,\n        clientX = _ref2.clientX,\n        clientY = _ref2.clientY;\n\n    if (shouldPreventNavigation()) {\n      (0, _pointer.notifyPointerMove)(null, target, clientX, clientY);\n      return;\n    }\n\n    var current = _getCurrent();\n\n    var update = (0, _pointer.notifyPointerMove)(current, target, clientX, clientY);\n\n    if (update) {\n      if (_5WayKeyHold) {\n        _pointerMoveDuringKeyPress = true;\n      }\n\n      var next = (0, _target.getNavigableTarget)(target); // TODO: Consider encapsulating this work within focusElement\n\n      if (next !== current) {\n        if (next) {\n          focusElement(next, (0, _container.getContainersForNode)(next), true);\n          return true;\n        } else if (current) {\n          current.blur();\n          (0, _container.setLastContainerFromTarget)(current, target);\n        }\n      }\n    }\n  }\n\n  function onMouseOver(evt) {\n    if (shouldPreventNavigation()) return;\n    var target = evt.target;\n\n    if ((0, _pointer.getPointerMode)() && (0, _pointer.hasPointerMoved)(evt.clientX, evt.clientY)) {\n      var next = (0, _target.getNavigableTarget)(target); // account for child controls\n\n      if (next && next !== _getCurrent()) {\n        focusElement(next, (0, _container.getContainersForNode)(next), true);\n        return true;\n      }\n\n      preventDefault(evt);\n    }\n  }\n\n  function onTouchEnd(evt) {\n    var current = _getCurrent();\n\n    if (current && !current.contains(evt.target)) {\n      current.blur();\n    }\n  }\n  /*\n   * public methods\n   */\n\n\n  var exports =\n  /** @lends spotlight.Spotlight */\n  {\n    // eslint-disable-line no-shadow\n\n    /**\n     * Initializes Spotlight. This is generally handled by\n     * {@link spotlight/SpotlightRootDecorator.SpotlightRootDecorator}.\n     *\n     * @param {Object} containerDefaults Default configuration for new spotlight containers\n     * @returns {undefined}\n     * @public\n     */\n    initialize: function initialize(containerDefaults) {\n      if (!_initialized) {\n        window.addEventListener('blur', onBlur);\n        window.addEventListener('focus', onFocus);\n        window.addEventListener('keydown', onKeyDown);\n        window.addEventListener('keyup', onKeyUp);\n        window.addEventListener('mouseover', onMouseOver);\n        window.addEventListener('mousemove', onMouseMove);\n\n        if (_platform[\"default\"].touch) {\n          window.addEventListener('touchend', onTouchEnd);\n        }\n\n        if (_platform[\"default\"].webos) {\n          window.top.document.addEventListener('webOSMouse', handleWebOSMouseEvent);\n          window.top.document.addEventListener('keyboardStateChange', handleKeyboardStateChangeEvent);\n        }\n\n        (0, _container.setLastContainer)(_container.rootContainerId);\n        (0, _container.configureDefaults)(containerDefaults);\n        (0, _container.configureContainer)(_container.rootContainerId); // by default, pointer mode is off but the platform's current state will override that\n\n        (0, _pointer.setPointerMode)(false);\n        setPlatformPointerMode();\n        _initialized = true;\n      }\n    },\n\n    /**\n     * Terminates Spotlight. This is generally handled by {@link spotlight.SpotlightRootDecorator}.\n     *\n     * @public\n     */\n    terminate: function terminate() {\n      window.removeEventListener('blur', onBlur);\n      window.removeEventListener('focus', onFocus);\n      window.removeEventListener('keydown', onKeyDown);\n      window.removeEventListener('keyup', onKeyUp);\n      window.removeEventListener('mouseover', onMouseOver);\n      window.removeEventListener('mousemove', onMouseMove);\n\n      if (_platform[\"default\"].touch) {\n        window.removeEventListener('touchend', onTouchEnd);\n      }\n\n      if (_platform[\"default\"].webos) {\n        window.top.document.removeEventListener('webOSMouse', handleWebOSMouseEvent);\n        window.top.document.removeEventListener('keyboardStateChange', handleKeyboardStateChangeEvent);\n      }\n\n      Spotlight.clear();\n      _initialized = false;\n    },\n\n    /**\n     * Resets spotlight container information\n     *\n     * @private\n     */\n    clear: function clear() {\n      (0, _container.removeAllContainers)();\n      (0, _container.setDefaultContainer)();\n      (0, _container.setLastContainer)();\n      _duringFocusChange = false;\n    },\n    // set(<config>);\n    // set(<containerId>, <config>);\n\n    /**\n     * Sets the config for spotlight or the specified containerID\n     *\n     * @function\n     * @param {String|Object} containerIdOrConfig  Configuration object or container ID\n     * @param {Object}        [config]             Configuration object if container ID supplied\n     *                                             in `containerIdOrConfig`\n     * @returns {undefined}\n     * @public\n     */\n    set: _container.configureContainer,\n    // add(<config>);\n    // add(<containerId>, <config>);\n\n    /**\n     * Adds the config for a new container. The container ID may be passed in the configuration\n     * object. If no container ID is supplied, a new container ID will be generated.\n     *\n     * @function\n     * @param {String|Object} containerIdOrConfig  Configuration object or container ID\n     * @param {Object}        [config]             Configuration object if container ID supplied\n     *                                             in `containerIdOrConfig`\n     * @returns {String} The container ID of the container\n     * @public\n     */\n    add: _container.addContainer,\n    unmount: function unmount(containerId) {\n      if (!containerId || typeof containerId !== 'string') {\n        throw new Error('Please assign the \"containerId\"!');\n      }\n\n      (0, _container.unmountContainer)(containerId);\n    },\n\n    /**\n     * Removes a container from Spotlight\n     *\n     * @param {String} containerId Container ID to remove\n     * @returns {Boolean} `true` if container removed, `false` if container does not exist\n     * @public\n     */\n    remove: function remove(containerId) {\n      if (!containerId || typeof containerId !== 'string') {\n        throw new Error('Please assign the \"containerId\"!');\n      }\n\n      if ((0, _container.getContainerConfig)(containerId)) {\n        (0, _container.removeContainer)(containerId);\n\n        if ((0, _container.getLastContainer)() === containerId) {\n          Spotlight.setActiveContainer(null);\n        }\n\n        return true;\n      }\n\n      return false;\n    },\n\n    /**\n     * Disables the selector rules of the specified container\n     *\n     * @param {String} containerId Container ID selector rules to disable\n     * @returns {Boolean} `true` if container's selector rules are disabled, `false` if container does not exist\n     * @public\n     */\n    disableSelector: function disableSelector(containerId) {\n      if ((0, _container.isContainer)(containerId)) {\n        (0, _container.configureContainer)(containerId, {\n          selectorDisabled: false\n        });\n        return true;\n      }\n\n      return false;\n    },\n\n    /**\n     * Enables the selector rules of the specified container\n     *\n     * @param {String} containerId Container ID selector rules to enable\n     * @returns {Boolean} `true` if container's selector rules are enabled, `false` if container does not exist\n     * @public\n     */\n    enableSelector: function enableSelector(containerId) {\n      if ((0, _container.isContainer)(containerId)) {\n        (0, _container.configureContainer)(containerId, {\n          selectorDisabled: false\n        });\n        return true;\n      }\n\n      return false;\n    },\n\n    /**\n     * Pauses Spotlight\n     *\n     * @function\n     * @returns {undefined}\n     * @public\n     */\n    pause: _Pause.pause,\n\n    /**\n     * Resumes Spotlight\n     *\n     * @function\n     * @returns {undefined}\n     * @public\n     */\n    resume: _Pause.resume,\n    // focus()\n    // focus(<containerId>)\n    // focus(<extSelector>)\n\n    /**\n     * Focuses the specified component ID, container ID, element selector, or the default\n     * container.\n     *\n     * If Spotlight is in pointer mode, focus is not changed but `elem` will be set as the last\n     * focused element of its spotlight containers.\n     *\n     * @param {String|Node} [elem] The spotlight ID or selector for either a spottable\n     *  component or a spotlight container, or spottable node. If not supplied, the default\n     *  container will be focused.\n     * @returns {Boolean} `true` if focus successful, `false` if not.\n     * @public\n     */\n    focus: function focus(elem) {\n      var target = elem;\n      var wasContainerId = false;\n\n      if (!elem) {\n        target = (0, _target.getTargetByContainer)();\n      } else if (typeof elem === 'string') {\n        if ((0, _container.getContainerConfig)(elem)) {\n          target = (0, _target.getTargetByContainer)(elem);\n          wasContainerId = true;\n        } else if (/^[\\w\\d-]+$/.test(elem)) {\n          // support component IDs consisting of alphanumeric, dash, or underscore\n          target = (0, _target.getTargetBySelector)(\"[data-spotlight-id=\".concat(elem, \"]\"));\n        } else {\n          target = (0, _target.getTargetBySelector)(elem);\n        }\n      } else if ((0, _container.isContainer)(elem)) {\n        target = (0, _target.getTargetByContainer)((0, _container.getContainerId)(elem));\n      }\n\n      var nextContainerIds = (0, _container.getContainersForNode)(target);\n      var nextContainerId = (0, _last[\"default\"])(nextContainerIds);\n\n      if ((0, _container.isNavigable)(target, nextContainerId, true)) {\n        var focused = focusElement(target, nextContainerIds);\n\n        if (!focused && wasContainerId) {\n          (0, _container.setLastContainer)(elem);\n        }\n\n        return focused;\n      } else if (wasContainerId) {\n        // if we failed to find a spottable target within the provided container, we'll set\n        // it as the active container to allow it to focus itself if its contents change\n        (0, _container.setLastContainer)(elem);\n      }\n\n      return false;\n    },\n    // move(<direction>)\n    // move(<direction>, <selector>)\n\n    /**\n     * Moves focus to the next spottable control in the direction specified. Optionally, a source\n     * element selector may be supplied as the starting point.\n     *\n     * @param {String} direction Direction to move, one of `'left'`, `'right'`, `'up'` or `'down'`\n     * @param {String|undefined} selector If supplied, the element to move from. If not supplied,\n     *\tthe currently focused item will be used.\n     * @returns {Boolean} `true` if focus successful, `false` if not.\n     * @public\n     */\n    move: function move(direction, selector) {\n      direction = direction.toLowerCase();\n\n      if (direction !== 'up' && direction !== 'down' && direction !== 'left' && direction !== 'right') {\n        return false;\n      }\n\n      var elem = selector ? (0, _utils.parseSelector)(selector)[0] : _getCurrent();\n\n      if (!elem) {\n        return false;\n      }\n\n      var containerIds = (0, _container.getContainersForNode)(elem);\n\n      if (!containerIds.length) {\n        return false;\n      }\n\n      return spotNext(direction, elem, containerIds);\n    },\n\n    /**\n     * Sets or clears the default container that will receive focus.\n     *\n     * @function\n     * @param {String} [containerId] The container ID or a falsy value to clear default\n     *                               container\n     * @returns {undefined}\n     * @public\n     */\n    setDefaultContainer: _container.setDefaultContainer,\n\n    /**\n     * Gets the currently active container.\n     *\n     * @returns {String} The id of the currently active container\n     * @public\n     */\n    getActiveContainer: function getActiveContainer() {\n      return (0, _container.getLastContainer)() || _container.rootContainerId;\n    },\n\n    /**\n     * Sets the currently active container.\n     *\n     * Note: If the current container is restricted to 'self-only' and `containerId` is not\n     * contained within the current container then the active container will not be updated.\n     *\n     * @param {String} [containerId] The id of the currently active container. If this is not\n     *\tprovided, the root container is set as the currently active container.\n     * @public\n     */\n    setActiveContainer: function setActiveContainer(containerId) {\n      if ((0, _container.mayActivateContainer)(containerId)) {\n        (0, _container.setLastContainer)(containerId || _container.rootContainerId);\n      }\n    },\n\n    /**\n     * Gets the current pointer mode\n     *\n     * @function\n     * @returns {Boolean} `true` if spotlight is in pointer mode\n     * @public\n     */\n    getPointerMode: _pointer.getPointerMode,\n\n    /**\n     * Sets the current pointer mode\n     *\n     * @function\n     * @param {Boolean} pointerMode The value of the pointer mode. This determines how\n     *\tspotlight manages focus change behaviors.\n     * @public\n     */\n    setPointerMode: _pointer.setPointerMode,\n\n    /**\n     * Gets the muted mode value of a spottable element.\n     *\n     * @param {Object} elem The dom element used to determine the muted status.\n     * @returns {Boolean} `true` if the passed-in control is in muted mode.\n     * @public\n     */\n    isMuted: function isMuted(elem) {\n      if (!elem) {\n        return false;\n      }\n\n      return (0, _utils.matchSelector)('[data-spotlight-container-muted=\"true\"] .' + _Spottable.spottableClass, elem);\n    },\n\n    /**\n     * Determines whether Spotlight is currently paused.\n     *\n     * @function\n     * @returns {Boolean} `true` if Spotlight is currently paused.\n     * @public\n     */\n    isPaused: _Pause.isPaused,\n\n    /**\n     * Determines whether an element is spottable.\n     *\n     * @param {Object} elem The dom element used to determine the spottable status.\n     * @returns {Boolean} `true` if the element being evaluated is currently spottable.\n     * @public\n     */\n    isSpottable: function isSpottable(elem) {\n      if (!elem) {\n        return false;\n      }\n\n      return (0, _target.isFocusable)(elem);\n    },\n\n    /**\n     * Returns the currently spotted control.\n     *\n     * @returns {Node} The control that currently has focus, if available\n     * @public\n     */\n    getCurrent: function getCurrent() {\n      return _getCurrent();\n    },\n\n    /**\n     * Returns a list of spottable elements wrapped by the supplied container.\n     *\n     * @param {String} containerId The id of the container used to determine the list of spottable elements\n     * @returns {Node[]} The spottable elements that are wrapped by the supplied container\n     * @public\n     */\n    getSpottableDescendants: function getSpottableDescendants(containerId) {\n      if (!containerId || typeof containerId !== 'string') {\n        throw new Error('Please assign the \"containerId\"!');\n      }\n\n      return (0, _container.getSpottableDescendants)(containerId);\n    }\n  };\n  return exports;\n}();\n\nexports.Spotlight = Spotlight;\nvar _default = Spotlight;\nexports[\"default\"] = _default;","map":{"version":3,"sources":["/Users/sonjaeseong/workspace/webOS/CARROT/webOS_GUI/node_modules/@enact/spotlight/src/spotlight.js"],"names":["Object","defineProperty","exports","value","Spotlight","getDirection","_keymap","require","_snapshot","_platform","_interopRequireDefault","_last","_Accelerator","_Spottable","_Pause","_utils","_container","_pointer","_target","obj","__esModule","isDown","is","isEnter","isLeft","isRight","isUp","keyCode","SpotlightAccelerator","_initialized","_duringFocusChange","_5WayKeyHold","_spotOnWindowFocus","_pointerMoveDuringKeyPress","preventDefault","evt","stopPropagation","shouldPreventNavigation","isPaused","getAllContainerIds","length","_getCurrent","isWindowReady","activeElement","document","body","setPlatformPointerMode","palmSystem","window","PalmSystem","cursor","setPointerMode","visibility","focusElement","elem","containerIds","fromPointer","getPointerMode","setContainerLastFocusedElement","currentFocusedElement","focusOptions","isWithinOverflowContainer","preventScroll","silentFocus","focus","focusChanged","getContainersForNode","containerId","setLastContainer","process","env","NODE_ENV","assignFocusPreview","restoreFocus","lastContainerId","getLastContainer","next","position","getLastPointerPosition","getContainerNode","reverse","lastFocusedElement","getContainerLastFocusedElement","isContainer","_getContainerConfig","getContainerConfig","lastContainerNode","getBoundingClientRect","contains","overflow","getNearestTargetFromPosition","unshift","rootContainerId","reduce","focused","target","directions","nextClassBase","spottableClass","forEach","dir","nextClass","prevElems","parseSelector","prevElem","classList","remove","nextElem","getTargetByDirectionFromElement","add","spotNextFromPoint","direction","getActiveContainer","getTargetByDirectionFromPosition","setContainerPreviousTarget","spotNext","currentContainerIds","currentContainerId","nextContainerIds","indexOf","isContainer5WayHoldable","notifyLeaveContainer","notifyEnterContainer","notifyLeaveContainerFail","onAcceleratedKeyDown","onBlur","current","blur","handleWebOSMouseEvent","ev","detail","type","handleKeyboardStateChangeEvent","_ref","onFocus","_getContainerConfig2","onKeyUp","reset","handlePointerHide","onKeyDown","notifyKeyDown","pointerHandled","processKey","onMouseMove","_ref2","clientX","clientY","notifyPointerMove","update","getNavigableTarget","setLastContainerFromTarget","onMouseOver","hasPointerMoved","onTouchEnd","initialize","containerDefaults","addEventListener","touch","webos","top","configureDefaults","configureContainer","terminate","removeEventListener","clear","removeAllContainers","setDefaultContainer","set","addContainer","unmount","Error","unmountContainer","removeContainer","setActiveContainer","disableSelector","selectorDisabled","enableSelector","pause","resume","wasContainerId","getTargetByContainer","test","getTargetBySelector","concat","getContainerId","nextContainerId","isNavigable","move","selector","toLowerCase","mayActivateContainer","isMuted","matchSelector","isSpottable","isFocusable","getCurrent","getSpottableDescendants","_default"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Spotlight = exports.getDirection = exports[\"default\"] = void 0;\n\nvar _keymap = require(\"@enact/core/keymap\");\n\nvar _snapshot = require(\"@enact/core/snapshot\");\n\nvar _platform = _interopRequireDefault(require(\"@enact/core/platform\"));\n\nvar _last = _interopRequireDefault(require(\"ramda/src/last\"));\n\nvar _Accelerator = _interopRequireDefault(require(\"../Accelerator\"));\n\nvar _Spottable = require(\"../Spottable\");\n\nvar _Pause = require(\"../Pause\");\n\nvar _utils = require(\"./utils\");\n\nvar _container = require(\"./container\");\n\nvar _pointer = require(\"./pointer\");\n\nvar _target = require(\"./target\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\n/*\n * A javascript-based implementation of Spatial Navigation.\n *\n * Copyright (c) 2016 Luke Chang.\n * https://github.com/luke-chang/js-spatial-navigation\n *\n * Licensed under the MPL license.\n */\n\n/**\n * Exports the {@link spotlight.Spotlight} object used for controlling spotlight behavior and the\n * {@link spotlight.Spotlight.getDirection} function for mapping a keycode to a spotlight direction.\n *\n * The default export is {@link spotlight.Spotlight}.\n *\n * @module spotlight\n * @exports default Spotlight\n * @exports getDirection\n */\nvar isDown = (0, _keymap.is)('down');\nvar isEnter = (0, _keymap.is)('enter');\nvar isLeft = (0, _keymap.is)('left');\nvar isRight = (0, _keymap.is)('right');\nvar isUp = (0, _keymap.is)('up');\n/**\n * Translates keyCodes into 5-way direction descriptions (e.g. `'down'`)\n *\n * @function\n * @memberof spotlight\n * @param {Number} keyCode - Key code to analyze\n * @returns {String|false} - One of `'up'`, `'down'`, `'left'`, `'right'` or `false` if not a direction key\n * @public\n */\n\nvar getDirection = function getDirection(keyCode) {\n  return isDown(keyCode) && 'down' || isLeft(keyCode) && 'left' || isRight(keyCode) && 'right' || isUp(keyCode) && 'up';\n};\n\nexports.getDirection = getDirection;\nvar SpotlightAccelerator = new _Accelerator[\"default\"]();\n/**\n * Provides 5-way navigation and focus support\n *\n * ```\n * import Spotlight from '@enact/Spotlight';\n *\n * // get the currently focused component\n * const current = Spotlight.getCurrent();\n *\n * // focus an element by CSS selector\n * Spotlight.focus('.my-custom-class');\n *\n * // is `current` focusable?\n * const isFocused = Spotlight.isSpottable(current);\n * ```\n *\n * @type {Object}\n * @memberof spotlight\n * @public\n */\n\nvar Spotlight = function () {\n  'use strict';\n  /*\n  /* private vars\n  */\n\n  var _initialized = false;\n  var _duringFocusChange = false;\n  /*\n   * Whether a 5-way directional key is being held.\n   *\n   * @type {Boolean}\n   * @default false\n   */\n\n  var _5WayKeyHold = false;\n  /*\n   * Whether to set focus during the next window focus event\n   *\n   * @type {Boolean}\n   * @default false\n   */\n\n  var _spotOnWindowFocus = false;\n  /*\n   * `true` when a pointer move event occurs during a keypress. Used to short circuit key down\n   * handling until the next keyup occurs.\n   *\n   * @type {Boolean}\n   * @default false\n   */\n\n  var _pointerMoveDuringKeyPress = false;\n  /*\n  * protected methods\n  */\n\n  function preventDefault(evt) {\n    evt.preventDefault();\n    evt.stopPropagation();\n    return false;\n  }\n\n  function shouldPreventNavigation() {\n    return (0, _Pause.isPaused)() || (0, _container.getAllContainerIds)().length === 0;\n  }\n\n  function _getCurrent() {\n    if (!(0, _snapshot.isWindowReady)()) return;\n    var activeElement = document.activeElement;\n\n    if (activeElement && activeElement !== document.body) {\n      return activeElement;\n    }\n  } // An extension point for updating pointer mode based on the current platform.\n  // Currently only webOS\n\n\n  function setPlatformPointerMode() {\n    var palmSystem = window.PalmSystem;\n\n    if (palmSystem && palmSystem.cursor) {\n      (0, _pointer.setPointerMode)(palmSystem.cursor.visibility);\n    }\n  }\n\n  function focusElement(elem, containerIds, fromPointer) {\n    if (!elem) {\n      return false;\n    }\n\n    if ((0, _pointer.getPointerMode)() && !fromPointer) {\n      (0, _container.setContainerLastFocusedElement)(elem, containerIds);\n      return false;\n    }\n\n    var currentFocusedElement = _getCurrent();\n\n    if (elem === currentFocusedElement) {\n      return true;\n    }\n\n    var focusOptions = (0, _container.isWithinOverflowContainer)(elem, containerIds) ? {\n      preventScroll: true\n    } : null;\n\n    var silentFocus = function silentFocus() {\n      elem.focus(focusOptions);\n      focusChanged(elem, containerIds);\n    };\n\n    if (_duringFocusChange) {\n      silentFocus();\n      return true;\n    }\n\n    _duringFocusChange = true;\n\n    if ((0, _Pause.isPaused)()) {\n      silentFocus();\n      _duringFocusChange = false;\n      return true;\n    }\n\n    elem.focus(focusOptions);\n    _duringFocusChange = false;\n    focusChanged(elem, containerIds);\n    return true;\n  }\n\n  function focusChanged(elem, containerIds) {\n    if (!containerIds || !containerIds.length) {\n      containerIds = (0, _container.getContainersForNode)(elem);\n    }\n\n    var containerId = (0, _last[\"default\"])(containerIds);\n\n    if (containerId) {\n      (0, _container.setContainerLastFocusedElement)(elem, containerIds);\n      (0, _container.setLastContainer)(containerId);\n    }\n\n    if (process.env.NODE_ENV !== \"production\") {\n      assignFocusPreview(elem);\n    }\n  }\n\n  function restoreFocus() {\n    var lastContainerId = (0, _container.getLastContainer)();\n    var next;\n\n    if (lastContainerId) {\n      var position = (0, _pointer.getLastPointerPosition)(); // walk up the chain of containers from the last to attempt to find a target\n\n      next = (0, _container.getContainersForNode)((0, _container.getContainerNode)(lastContainerId)).reverse(); // only prepend last focused if it exists so that Spotlight.focus() doesn't receive\n      // a falsy target\n\n      var lastFocusedElement = (0, _container.getContainerLastFocusedElement)(lastContainerId);\n\n      while ((0, _container.isContainer)(lastFocusedElement)) {\n        var _getContainerConfig = (0, _container.getContainerConfig)(lastFocusedElement);\n\n        lastFocusedElement = _getContainerConfig.lastFocusedElement;\n      }\n\n      var lastContainerNode = (0, _container.getContainerNode)(lastContainerId);\n\n      if (!lastFocusedElement || lastContainerNode.getBoundingClientRect && lastFocusedElement.getBoundingClientRect && !(0, _utils.contains)(lastContainerNode.getBoundingClientRect(), lastFocusedElement.getBoundingClientRect())) {\n        lastFocusedElement = (0, _container.getContainerConfig)(lastContainerId).overflow && (0, _target.getNearestTargetFromPosition)(position, lastContainerId);\n      }\n\n      if (lastFocusedElement) {\n        next.unshift(lastFocusedElement);\n      }\n    } else {\n      next = [_container.rootContainerId];\n    } // attempt to find a target starting with the last focused element in the last\n    // container, followed by the last container, and finally the root container\n\n\n    return next.reduce(function (focused, target) {\n      return focused || Spotlight.focus(target);\n    }, false);\n  } // The below should be gated on non-production environment only.\n\n\n  function assignFocusPreview(elem) {\n    var directions = ['up', 'right', 'down', 'left'],\n        nextClassBase = _Spottable.spottableClass + '-next-'; // Remove all previous targets\n\n    directions.forEach(function (dir) {\n      var nextClass = nextClassBase + dir,\n          prevElems = (0, _utils.parseSelector)('.' + nextClass);\n\n      if (prevElems && prevElems.length !== 0) {\n        prevElems.forEach(function (prevElem) {\n          return prevElem.classList.remove(nextClass);\n        });\n      }\n    }); // Find all next targets and identify them\n\n    directions.forEach(function (dir) {\n      var nextElem = (0, _target.getTargetByDirectionFromElement)(dir, elem);\n\n      if (nextElem) {\n        nextElem.classList.add(nextClassBase + dir);\n      }\n    });\n  }\n\n  function spotNextFromPoint(direction, position) {\n    var containerId = Spotlight.getActiveContainer();\n    var next = (0, _target.getTargetByDirectionFromPosition)(direction, position, containerId);\n\n    if (next) {\n      (0, _container.setContainerPreviousTarget)(containerId, direction, next, (0, _container.getContainerLastFocusedElement)(containerId));\n      return focusElement(next, (0, _container.getContainersForNode)(next));\n    }\n\n    return false;\n  }\n\n  function spotNext(direction, currentFocusedElement, currentContainerIds) {\n    var next = (0, _target.getTargetByDirectionFromElement)(direction, currentFocusedElement);\n\n    if (next) {\n      var currentContainerId = (0, _last[\"default\"])(currentContainerIds);\n      var nextContainerIds = (0, _container.getContainersForNode)(next); // prevent focus if 5-way is being held and the next element isn't wrapped by\n      // the current element's immediate container\n\n      if (_5WayKeyHold && nextContainerIds.indexOf(currentContainerId) < 0 && !(0, _container.isContainer5WayHoldable)(currentContainerId)) {\n        return false;\n      }\n\n      (0, _container.notifyLeaveContainer)(direction, currentFocusedElement, currentContainerIds, next, nextContainerIds);\n      (0, _container.setContainerPreviousTarget)(currentContainerId, direction, next, currentFocusedElement);\n      var focused = focusElement(next, nextContainerIds);\n      (0, _container.notifyEnterContainer)(direction, currentFocusedElement, currentContainerIds, next, nextContainerIds);\n      return focused;\n    }\n\n    (0, _container.notifyLeaveContainerFail)(direction, currentFocusedElement, currentContainerIds);\n    return false;\n  }\n\n  function onAcceleratedKeyDown(evt) {\n    var direction = getDirection(evt.keyCode);\n    if (!direction) return;\n\n    var currentFocusedElement = _getCurrent();\n\n    var currentContainerIds = (0, _container.getContainersForNode)(currentFocusedElement);\n    spotNext(direction, currentFocusedElement, currentContainerIds);\n  }\n\n  function onBlur() {\n    var current = _getCurrent();\n\n    if (current) {\n      current.blur();\n    }\n\n    Spotlight.setPointerMode(false);\n    _spotOnWindowFocus = true;\n    _pointerMoveDuringKeyPress = false;\n  }\n\n  function handleWebOSMouseEvent(ev) {\n    if (!(0, _Pause.isPaused)() && ev && ev.detail && ev.detail.type === 'Leave') {\n      onBlur();\n    }\n  }\n\n  function handleKeyboardStateChangeEvent(_ref) {\n    var visibility = _ref.visibility;\n\n    if (!visibility) {\n      setPlatformPointerMode();\n    }\n  }\n\n  function onFocus() {\n    // Normally, there isn't focus here unless the window has been blurred above. On webOS, the\n    // platform may focus the window after the app has already focused a component so we prevent\n    // trying to focus something else (potentially) unless the window was previously blurred\n    if (_spotOnWindowFocus) {\n      setPlatformPointerMode(); // If the window was previously blurred while in pointer mode, the last active containerId may\n      // not have yet set focus to its spottable elements. For this reason we can't rely on setting focus\n      // to the last focused element of the last active containerId, so we use rootContainerId instead\n\n      var lastFocusedElement = (0, _container.getContainerLastFocusedElement)(_container.rootContainerId);\n\n      while ((0, _container.isContainer)(lastFocusedElement)) {\n        var _getContainerConfig2 = (0, _container.getContainerConfig)(lastFocusedElement);\n\n        lastFocusedElement = _getContainerConfig2.lastFocusedElement;\n      }\n\n      if (!Spotlight.focus(lastFocusedElement)) {\n        // If the last focused element was previously also disabled (or no longer exists), we\n        // need to set focus somewhere\n        Spotlight.focus();\n      }\n\n      _spotOnWindowFocus = false;\n    }\n  }\n\n  function onKeyUp(evt) {\n    _pointerMoveDuringKeyPress = false;\n    var keyCode = evt.keyCode;\n\n    if (getDirection(keyCode) || isEnter(keyCode)) {\n      SpotlightAccelerator.reset();\n      _5WayKeyHold = false;\n    }\n  }\n\n  function handlePointerHide() {\n    if (!_getCurrent()) {\n      restoreFocus();\n    }\n  }\n\n  function onKeyDown(evt) {\n    if (shouldPreventNavigation()) {\n      (0, _pointer.notifyKeyDown)(evt.keyCode);\n      return;\n    }\n\n    var keyCode = evt.keyCode;\n    var direction = getDirection(keyCode);\n    var pointerHandled = (0, _pointer.notifyKeyDown)(keyCode, handlePointerHide);\n\n    if (pointerHandled || !(direction || isEnter(keyCode))) {\n      return;\n    }\n\n    if (!(0, _Pause.isPaused)() && !_pointerMoveDuringKeyPress) {\n      if (_getCurrent()) {\n        SpotlightAccelerator.processKey(evt, onAcceleratedKeyDown);\n      } else if (!spotNextFromPoint(direction, (0, _pointer.getLastPointerPosition)())) {\n        restoreFocus();\n      }\n\n      _5WayKeyHold = true;\n    }\n\n    if (direction) {\n      preventDefault(evt);\n    }\n  }\n\n  function onMouseMove(_ref2) {\n    var target = _ref2.target,\n        clientX = _ref2.clientX,\n        clientY = _ref2.clientY;\n\n    if (shouldPreventNavigation()) {\n      (0, _pointer.notifyPointerMove)(null, target, clientX, clientY);\n      return;\n    }\n\n    var current = _getCurrent();\n\n    var update = (0, _pointer.notifyPointerMove)(current, target, clientX, clientY);\n\n    if (update) {\n      if (_5WayKeyHold) {\n        _pointerMoveDuringKeyPress = true;\n      }\n\n      var next = (0, _target.getNavigableTarget)(target); // TODO: Consider encapsulating this work within focusElement\n\n      if (next !== current) {\n        if (next) {\n          focusElement(next, (0, _container.getContainersForNode)(next), true);\n          return true;\n        } else if (current) {\n          current.blur();\n          (0, _container.setLastContainerFromTarget)(current, target);\n        }\n      }\n    }\n  }\n\n  function onMouseOver(evt) {\n    if (shouldPreventNavigation()) return;\n    var target = evt.target;\n\n    if ((0, _pointer.getPointerMode)() && (0, _pointer.hasPointerMoved)(evt.clientX, evt.clientY)) {\n      var next = (0, _target.getNavigableTarget)(target); // account for child controls\n\n      if (next && next !== _getCurrent()) {\n        focusElement(next, (0, _container.getContainersForNode)(next), true);\n        return true;\n      }\n\n      preventDefault(evt);\n    }\n  }\n\n  function onTouchEnd(evt) {\n    var current = _getCurrent();\n\n    if (current && !current.contains(evt.target)) {\n      current.blur();\n    }\n  }\n  /*\n   * public methods\n   */\n\n\n  var exports =\n  /** @lends spotlight.Spotlight */\n  {\n    // eslint-disable-line no-shadow\n\n    /**\n     * Initializes Spotlight. This is generally handled by\n     * {@link spotlight/SpotlightRootDecorator.SpotlightRootDecorator}.\n     *\n     * @param {Object} containerDefaults Default configuration for new spotlight containers\n     * @returns {undefined}\n     * @public\n     */\n    initialize: function initialize(containerDefaults) {\n      if (!_initialized) {\n        window.addEventListener('blur', onBlur);\n        window.addEventListener('focus', onFocus);\n        window.addEventListener('keydown', onKeyDown);\n        window.addEventListener('keyup', onKeyUp);\n        window.addEventListener('mouseover', onMouseOver);\n        window.addEventListener('mousemove', onMouseMove);\n\n        if (_platform[\"default\"].touch) {\n          window.addEventListener('touchend', onTouchEnd);\n        }\n\n        if (_platform[\"default\"].webos) {\n          window.top.document.addEventListener('webOSMouse', handleWebOSMouseEvent);\n          window.top.document.addEventListener('keyboardStateChange', handleKeyboardStateChangeEvent);\n        }\n\n        (0, _container.setLastContainer)(_container.rootContainerId);\n        (0, _container.configureDefaults)(containerDefaults);\n        (0, _container.configureContainer)(_container.rootContainerId); // by default, pointer mode is off but the platform's current state will override that\n\n        (0, _pointer.setPointerMode)(false);\n        setPlatformPointerMode();\n        _initialized = true;\n      }\n    },\n\n    /**\n     * Terminates Spotlight. This is generally handled by {@link spotlight.SpotlightRootDecorator}.\n     *\n     * @public\n     */\n    terminate: function terminate() {\n      window.removeEventListener('blur', onBlur);\n      window.removeEventListener('focus', onFocus);\n      window.removeEventListener('keydown', onKeyDown);\n      window.removeEventListener('keyup', onKeyUp);\n      window.removeEventListener('mouseover', onMouseOver);\n      window.removeEventListener('mousemove', onMouseMove);\n\n      if (_platform[\"default\"].touch) {\n        window.removeEventListener('touchend', onTouchEnd);\n      }\n\n      if (_platform[\"default\"].webos) {\n        window.top.document.removeEventListener('webOSMouse', handleWebOSMouseEvent);\n        window.top.document.removeEventListener('keyboardStateChange', handleKeyboardStateChangeEvent);\n      }\n\n      Spotlight.clear();\n      _initialized = false;\n    },\n\n    /**\n     * Resets spotlight container information\n     *\n     * @private\n     */\n    clear: function clear() {\n      (0, _container.removeAllContainers)();\n      (0, _container.setDefaultContainer)();\n      (0, _container.setLastContainer)();\n      _duringFocusChange = false;\n    },\n    // set(<config>);\n    // set(<containerId>, <config>);\n\n    /**\n     * Sets the config for spotlight or the specified containerID\n     *\n     * @function\n     * @param {String|Object} containerIdOrConfig  Configuration object or container ID\n     * @param {Object}        [config]             Configuration object if container ID supplied\n     *                                             in `containerIdOrConfig`\n     * @returns {undefined}\n     * @public\n     */\n    set: _container.configureContainer,\n    // add(<config>);\n    // add(<containerId>, <config>);\n\n    /**\n     * Adds the config for a new container. The container ID may be passed in the configuration\n     * object. If no container ID is supplied, a new container ID will be generated.\n     *\n     * @function\n     * @param {String|Object} containerIdOrConfig  Configuration object or container ID\n     * @param {Object}        [config]             Configuration object if container ID supplied\n     *                                             in `containerIdOrConfig`\n     * @returns {String} The container ID of the container\n     * @public\n     */\n    add: _container.addContainer,\n    unmount: function unmount(containerId) {\n      if (!containerId || typeof containerId !== 'string') {\n        throw new Error('Please assign the \"containerId\"!');\n      }\n\n      (0, _container.unmountContainer)(containerId);\n    },\n\n    /**\n     * Removes a container from Spotlight\n     *\n     * @param {String} containerId Container ID to remove\n     * @returns {Boolean} `true` if container removed, `false` if container does not exist\n     * @public\n     */\n    remove: function remove(containerId) {\n      if (!containerId || typeof containerId !== 'string') {\n        throw new Error('Please assign the \"containerId\"!');\n      }\n\n      if ((0, _container.getContainerConfig)(containerId)) {\n        (0, _container.removeContainer)(containerId);\n\n        if ((0, _container.getLastContainer)() === containerId) {\n          Spotlight.setActiveContainer(null);\n        }\n\n        return true;\n      }\n\n      return false;\n    },\n\n    /**\n     * Disables the selector rules of the specified container\n     *\n     * @param {String} containerId Container ID selector rules to disable\n     * @returns {Boolean} `true` if container's selector rules are disabled, `false` if container does not exist\n     * @public\n     */\n    disableSelector: function disableSelector(containerId) {\n      if ((0, _container.isContainer)(containerId)) {\n        (0, _container.configureContainer)(containerId, {\n          selectorDisabled: false\n        });\n        return true;\n      }\n\n      return false;\n    },\n\n    /**\n     * Enables the selector rules of the specified container\n     *\n     * @param {String} containerId Container ID selector rules to enable\n     * @returns {Boolean} `true` if container's selector rules are enabled, `false` if container does not exist\n     * @public\n     */\n    enableSelector: function enableSelector(containerId) {\n      if ((0, _container.isContainer)(containerId)) {\n        (0, _container.configureContainer)(containerId, {\n          selectorDisabled: false\n        });\n        return true;\n      }\n\n      return false;\n    },\n\n    /**\n     * Pauses Spotlight\n     *\n     * @function\n     * @returns {undefined}\n     * @public\n     */\n    pause: _Pause.pause,\n\n    /**\n     * Resumes Spotlight\n     *\n     * @function\n     * @returns {undefined}\n     * @public\n     */\n    resume: _Pause.resume,\n    // focus()\n    // focus(<containerId>)\n    // focus(<extSelector>)\n\n    /**\n     * Focuses the specified component ID, container ID, element selector, or the default\n     * container.\n     *\n     * If Spotlight is in pointer mode, focus is not changed but `elem` will be set as the last\n     * focused element of its spotlight containers.\n     *\n     * @param {String|Node} [elem] The spotlight ID or selector for either a spottable\n     *  component or a spotlight container, or spottable node. If not supplied, the default\n     *  container will be focused.\n     * @returns {Boolean} `true` if focus successful, `false` if not.\n     * @public\n     */\n    focus: function focus(elem) {\n      var target = elem;\n      var wasContainerId = false;\n\n      if (!elem) {\n        target = (0, _target.getTargetByContainer)();\n      } else if (typeof elem === 'string') {\n        if ((0, _container.getContainerConfig)(elem)) {\n          target = (0, _target.getTargetByContainer)(elem);\n          wasContainerId = true;\n        } else if (/^[\\w\\d-]+$/.test(elem)) {\n          // support component IDs consisting of alphanumeric, dash, or underscore\n          target = (0, _target.getTargetBySelector)(\"[data-spotlight-id=\".concat(elem, \"]\"));\n        } else {\n          target = (0, _target.getTargetBySelector)(elem);\n        }\n      } else if ((0, _container.isContainer)(elem)) {\n        target = (0, _target.getTargetByContainer)((0, _container.getContainerId)(elem));\n      }\n\n      var nextContainerIds = (0, _container.getContainersForNode)(target);\n      var nextContainerId = (0, _last[\"default\"])(nextContainerIds);\n\n      if ((0, _container.isNavigable)(target, nextContainerId, true)) {\n        var focused = focusElement(target, nextContainerIds);\n\n        if (!focused && wasContainerId) {\n          (0, _container.setLastContainer)(elem);\n        }\n\n        return focused;\n      } else if (wasContainerId) {\n        // if we failed to find a spottable target within the provided container, we'll set\n        // it as the active container to allow it to focus itself if its contents change\n        (0, _container.setLastContainer)(elem);\n      }\n\n      return false;\n    },\n    // move(<direction>)\n    // move(<direction>, <selector>)\n\n    /**\n     * Moves focus to the next spottable control in the direction specified. Optionally, a source\n     * element selector may be supplied as the starting point.\n     *\n     * @param {String} direction Direction to move, one of `'left'`, `'right'`, `'up'` or `'down'`\n     * @param {String|undefined} selector If supplied, the element to move from. If not supplied,\n     *\tthe currently focused item will be used.\n     * @returns {Boolean} `true` if focus successful, `false` if not.\n     * @public\n     */\n    move: function move(direction, selector) {\n      direction = direction.toLowerCase();\n\n      if (direction !== 'up' && direction !== 'down' && direction !== 'left' && direction !== 'right') {\n        return false;\n      }\n\n      var elem = selector ? (0, _utils.parseSelector)(selector)[0] : _getCurrent();\n\n      if (!elem) {\n        return false;\n      }\n\n      var containerIds = (0, _container.getContainersForNode)(elem);\n\n      if (!containerIds.length) {\n        return false;\n      }\n\n      return spotNext(direction, elem, containerIds);\n    },\n\n    /**\n     * Sets or clears the default container that will receive focus.\n     *\n     * @function\n     * @param {String} [containerId] The container ID or a falsy value to clear default\n     *                               container\n     * @returns {undefined}\n     * @public\n     */\n    setDefaultContainer: _container.setDefaultContainer,\n\n    /**\n     * Gets the currently active container.\n     *\n     * @returns {String} The id of the currently active container\n     * @public\n     */\n    getActiveContainer: function getActiveContainer() {\n      return (0, _container.getLastContainer)() || _container.rootContainerId;\n    },\n\n    /**\n     * Sets the currently active container.\n     *\n     * Note: If the current container is restricted to 'self-only' and `containerId` is not\n     * contained within the current container then the active container will not be updated.\n     *\n     * @param {String} [containerId] The id of the currently active container. If this is not\n     *\tprovided, the root container is set as the currently active container.\n     * @public\n     */\n    setActiveContainer: function setActiveContainer(containerId) {\n      if ((0, _container.mayActivateContainer)(containerId)) {\n        (0, _container.setLastContainer)(containerId || _container.rootContainerId);\n      }\n    },\n\n    /**\n     * Gets the current pointer mode\n     *\n     * @function\n     * @returns {Boolean} `true` if spotlight is in pointer mode\n     * @public\n     */\n    getPointerMode: _pointer.getPointerMode,\n\n    /**\n     * Sets the current pointer mode\n     *\n     * @function\n     * @param {Boolean} pointerMode The value of the pointer mode. This determines how\n     *\tspotlight manages focus change behaviors.\n     * @public\n     */\n    setPointerMode: _pointer.setPointerMode,\n\n    /**\n     * Gets the muted mode value of a spottable element.\n     *\n     * @param {Object} elem The dom element used to determine the muted status.\n     * @returns {Boolean} `true` if the passed-in control is in muted mode.\n     * @public\n     */\n    isMuted: function isMuted(elem) {\n      if (!elem) {\n        return false;\n      }\n\n      return (0, _utils.matchSelector)('[data-spotlight-container-muted=\"true\"] .' + _Spottable.spottableClass, elem);\n    },\n\n    /**\n     * Determines whether Spotlight is currently paused.\n     *\n     * @function\n     * @returns {Boolean} `true` if Spotlight is currently paused.\n     * @public\n     */\n    isPaused: _Pause.isPaused,\n\n    /**\n     * Determines whether an element is spottable.\n     *\n     * @param {Object} elem The dom element used to determine the spottable status.\n     * @returns {Boolean} `true` if the element being evaluated is currently spottable.\n     * @public\n     */\n    isSpottable: function isSpottable(elem) {\n      if (!elem) {\n        return false;\n      }\n\n      return (0, _target.isFocusable)(elem);\n    },\n\n    /**\n     * Returns the currently spotted control.\n     *\n     * @returns {Node} The control that currently has focus, if available\n     * @public\n     */\n    getCurrent: function getCurrent() {\n      return _getCurrent();\n    },\n\n    /**\n     * Returns a list of spottable elements wrapped by the supplied container.\n     *\n     * @param {String} containerId The id of the container used to determine the list of spottable elements\n     * @returns {Node[]} The spottable elements that are wrapped by the supplied container\n     * @public\n     */\n    getSpottableDescendants: function getSpottableDescendants(containerId) {\n      if (!containerId || typeof containerId !== 'string') {\n        throw new Error('Please assign the \"containerId\"!');\n      }\n\n      return (0, _container.getSpottableDescendants)(containerId);\n    }\n  };\n  return exports;\n}();\n\nexports.Spotlight = Spotlight;\nvar _default = Spotlight;\nexports[\"default\"] = _default;"]},"metadata":{},"sourceType":"module"}