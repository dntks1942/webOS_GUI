"use strict";

var _react = _interopRequireDefault(require("react"));

var _enzyme = require("enzyme");

var _index = require("../index.js");

var _MarqueeModule = _interopRequireDefault(require("../Marquee.module.css"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var ltrText = 'This is some fine latin text.',
    rtlText = 'العربية - العراق',
    contentSelector = ".".concat(_MarqueeModule["default"].text);
describe('Marquee', function () {
  beforeEach(function () {
    global.Element.prototype.getBoundingClientRect = jest.fn(function () {
      return {
        width: 100,
        height: 50,
        top: 0,
        left: 0,
        bottom: 0,
        right: 0
      };
    });
  });
  test('should determine the correct directionality of latin text on initial render', function () {
    var subject = (0, _enzyme.mount)( /*#__PURE__*/_react["default"].createElement(_index.Marquee, null, ltrText));
    var expected = 'ltr';
    var actual = subject.find(contentSelector).prop('style');
    expect(actual).toHaveProperty('direction', expected);
  });
  test('should determine the correct directionality of non-latin text on initial render', function () {
    var subject = (0, _enzyme.mount)( /*#__PURE__*/_react["default"].createElement(_index.Marquee, null, rtlText));
    var expected = 'rtl';
    var actual = subject.find(contentSelector).prop('style');
    expect(actual).toHaveProperty('direction', expected);
  });
  test('should force the directionality text if forceDirection is specified', function () {
    var subject = (0, _enzyme.mount)( /*#__PURE__*/_react["default"].createElement(_index.Marquee, {
      forceDirection: "ltr"
    }, rtlText));
    var expected = 'ltr';
    var actual = subject.find(contentSelector).prop('style');
    expect(actual).toHaveProperty('direction', expected);
  });
  test('should switch directionality when the text content changes after initial render', function () {
    var subject = (0, _enzyme.mount)( /*#__PURE__*/_react["default"].createElement(_index.Marquee, null, ltrText));
    subject.setProps({
      children: rtlText
    });
    subject.update();
    var expected = 'rtl';
    var actual = subject.find(contentSelector).prop('style');
    expect(actual).toHaveProperty('direction', expected);
  });
  test('should not switch directionality when the text content changes after initial render and the forceDirection property was already set', function () {
    var subject = (0, _enzyme.mount)( /*#__PURE__*/_react["default"].createElement(_index.Marquee, {
      forceDirection: "ltr"
    }, ltrText));
    subject.setProps({
      children: rtlText
    });
    subject.update();
    var expected = 'ltr';
    var actual = subject.find(contentSelector).prop('style');
    expect(actual).toHaveProperty('direction', expected);
  });
  test('should override direction to RTL when forceDirection is set and locale is LTR', function () {
    var subject = (0, _enzyme.mount)( /*#__PURE__*/_react["default"].createElement(_index.Marquee, {
      forceDirection: "rtl",
      locale: "ltr"
    }));
    var expected = 'rtl';
    var actual = subject.find(contentSelector).prop('style');
    expect(actual).toHaveProperty('direction', expected);
  });
  test('should override direction to LTR when forceDirection is set and locale is RTL', function () {
    var subject = (0, _enzyme.mount)( /*#__PURE__*/_react["default"].createElement(_index.Marquee, {
      forceDirection: "ltr",
      locale: "rtl"
    }));
    var expected = 'ltr';
    var actual = subject.find(contentSelector).prop('style');
    expect(actual).toHaveProperty('direction', expected);
  });
  test('should have direction of RTL when forceDirection is RTL and locale is RTL', function () {
    var subject = (0, _enzyme.mount)( /*#__PURE__*/_react["default"].createElement(_index.Marquee, {
      forceDirection: "rtl",
      locale: "rtl"
    }));
    var expected = 'rtl';
    var actual = subject.find(contentSelector).prop('style');
    expect(actual).toHaveProperty('direction', expected);
  });
  test('should have direction of LTR when forceDirection is LTR and locale is LTR', function () {
    var subject = (0, _enzyme.mount)( /*#__PURE__*/_react["default"].createElement(_index.Marquee, {
      forceDirection: "ltr",
      locale: "ltr"
    }));
    var expected = 'ltr';
    var actual = subject.find(contentSelector).prop('style');
    expect(actual).toHaveProperty('direction', expected);
  });
  test('should convert percentage values of marqueeSpacing to absolute values', function (done) {
    var subject = (0, _enzyme.mount)( /*#__PURE__*/_react["default"].createElement(_index.Marquee, {
      marqueeSpacing: "60%",
      marqueeOn: "render",
      marqueeOnRenderDelay: 10
    }));
    setTimeout(function () {
      subject.update();
      var expected = 60;
      var actual = subject.find(_index.MarqueeBase).prop('spacing');
      expect(actual).toBe(expected);
      done();
    }, 100);
  });
  test('should pass absolute values of marqueeSpacing', function (done) {
    var subject = (0, _enzyme.mount)( /*#__PURE__*/_react["default"].createElement(_index.Marquee, {
      marqueeSpacing: 80,
      marqueeOn: "render",
      marqueeOnRenderDelay: 10
    }));
    setTimeout(function () {
      subject.update();
      var expected = 80;
      var actual = subject.find(_index.MarqueeBase).prop('spacing');
      expect(actual).toBe(expected);
      done();
    }, 100);
  });
});
describe('MarqueeBase', function () {
  // Computed Property Tests
  test('should not include the animate class when animating is false', function () {
    var subject = (0, _enzyme.shallow)( /*#__PURE__*/_react["default"].createElement(_index.MarqueeBase, null));
    var expected = false;
    var actual = subject.childAt(0).hasClass(_MarqueeModule["default"].animate);
    expect(actual).toBe(expected);
  });
  test('should include the animate class when animating is true', function () {
    var subject = (0, _enzyme.shallow)( /*#__PURE__*/_react["default"].createElement(_index.MarqueeBase, {
      animating: true
    }));
    var expected = true;
    var actual = subject.childAt(0).hasClass(_MarqueeModule["default"].animate);
    expect(actual).toBe(expected);
  });
  test('should not transition when animating is false', function () {
    var subject = (0, _enzyme.shallow)( /*#__PURE__*/_react["default"].createElement(_index.MarqueeBase, null));
    var actual = subject.childAt(0).prop('style');
    expect(actual).not.toHaveProperty('transition');
  });
  test('should transition when animating is true', function () {
    var subject = (0, _enzyme.shallow)( /*#__PURE__*/_react["default"].createElement(_index.MarqueeBase, {
      animating: true
    }));
    var actual = subject.childAt(0).prop('style');
    expect(actual).toHaveProperty('transitionDuration');
  });
  test('should set RTL direction in LTR context when the text directionality is RTL', function () {
    var subject = (0, _enzyme.shallow)( /*#__PURE__*/_react["default"].createElement(_index.MarqueeBase, {
      rtl: true
    }), {
      context: {
        rtl: false
      }
    });
    var expected = 'rtl';
    var actual = subject.childAt(0).prop('style').direction;
    expect(actual).toBe(expected);
  });
  test('should set LTR direction in RTL when the text directionality is LTR', function () {
    var subject = (0, _enzyme.shallow)( /*#__PURE__*/_react["default"].createElement(_index.MarqueeBase, null), {
      context: {
        rtl: true
      }
    });
    var expected = 'ltr';
    var actual = subject.childAt(0).prop('style').direction;
    expect(actual).toBe(expected);
  });
  test('should transition from the right with LTR text (a negative translate value)', function () {
    var subject = (0, _enzyme.shallow)( /*#__PURE__*/_react["default"].createElement(_index.MarqueeBase, {
      animating: true,
      distance: 100
    }));
    var actual = subject.childAt(0).prop('style').transform;
    expect(actual).toContain('-');
  });
  test('should transition from the left with RTL text (a positive translate value)', function () {
    var subject = (0, _enzyme.shallow)( /*#__PURE__*/_react["default"].createElement(_index.MarqueeBase, {
      animating: true,
      distance: 100,
      rtl: true
    }));
    var actual = subject.childAt(0).prop('style').transform;
    expect(actual).not.toContain('-');
  });
  test('should duplicate from content when promoted and a non-zero distance', function () {
    var subject = (0, _enzyme.shallow)( /*#__PURE__*/_react["default"].createElement(_index.MarqueeBase, {
      willAnimate: true,
      distance: 100
    }, "Text"));
    var actual = subject.text();
    expect(actual).toBe('TextText');
  });
  test('should not duplicate from content when promoted and a zero distance', function () {
    var subject = (0, _enzyme.shallow)( /*#__PURE__*/_react["default"].createElement(_index.MarqueeBase, {
      willAnimate: true,
      distance: 0
    }, "Text"));
    var actual = subject.text();
    expect(actual).toBe('Text');
  });
  test('should not duplicate from content when not promoted and a non-zero distance', function () {
    var subject = (0, _enzyme.shallow)( /*#__PURE__*/_react["default"].createElement(_index.MarqueeBase, {
      distance: 100
    }, "Text"));
    var actual = subject.text();
    expect(actual).toBe('Text');
  });
  test('should add aria-label with content when promoted and a non-zero distance', function () {
    var text = 'Text';
    var subject = (0, _enzyme.mount)( /*#__PURE__*/_react["default"].createElement(_index.MarqueeBase, {
      willAnimate: true,
      distance: 100
    }, text));
    var expected = text;
    var actual = subject.childAt(0).prop('aria-label');
    expect(actual).toBe(expected);
  });
  test('should not override aria-label with content when promoted and a non-zero distance', function () {
    var aria = 'Custom';
    var subject = (0, _enzyme.mount)( /*#__PURE__*/_react["default"].createElement(_index.MarqueeBase, {
      willAnimate: true,
      distance: 100,
      "aria-label": aria
    }, "Text"));
    var expected = aria;
    var actual = subject.childAt(0).prop('aria-label');
    expect(actual).toBe(expected);
  });
  test('should concatenate string children when promoted and a non-zero distance', function () {
    var subject = (0, _enzyme.mount)( /*#__PURE__*/_react["default"].createElement(_index.MarqueeBase, {
      willAnimate: true,
      distance: 100
    }, "This is ", 'A', " test"));
    var expected = 'This is  A  test';
    var actual = subject.childAt(0).prop('aria-label');
    expect(actual).toBe(expected);
  });
  test('should not concatenate non-string children when promoted and a non-zero distance', function () {
    var subject = (0, _enzyme.mount)( /*#__PURE__*/_react["default"].createElement(_index.MarqueeBase, {
      willAnimate: true,
      distance: 100
    }, "Test", /*#__PURE__*/_react["default"].createElement("div", null, "Hello"), "World"));
    var expected = 'Test World';
    var actual = subject.childAt(0).prop('aria-label');
    expect(actual).toBe(expected);
  });
  test('should not throw exception for null children when promoted and a non-zero distance - ENYO-6362', function () {
    var mountSubject = function mountSubject() {
      return (0, _enzyme.mount)( /*#__PURE__*/_react["default"].createElement(_index.MarqueeBase, {
        willAnimate: true,
        distance: 100
      }, null));
    };

    expect(mountSubject).not.toThrow();
  });
});